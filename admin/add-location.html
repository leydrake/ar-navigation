<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Location</title>
    <link rel="stylesheet" href="css/add-location.css">
</head>
<body>
    <div class="add-location-container">
        <div class="add-location-header">
            <button class="back-btn" aria-label="Back" onclick="goBackToAdminTools()">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                    <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <span class="add-location-title">Add Location</span>

        </div>
        <div class="image-upload-area">
            <input type="file" id="location-image" accept="image/*" hidden />
            <label for="location-image" class="image-upload-label">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none">
                    <rect x="2" y="2" width="20" height="20" rx="4" fill="#d3d3d3"/>
                    <path d="M8 15l2.5-3 2.5 3 3.5-4.5L20 17H4l4-5z" stroke="#206233" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="9" cy="9" r="2" stroke="#206233" stroke-width="2"/>
                </svg>
            </label>
        </div>
        <div class="location-form-area">
            <form class="location-form">
                <label for="location-name">Location Name</label>
                <input type="text" id="location-name" name="location-name" required />
                <label for="location-x">X</label>
                <input type="number" id="location-x" name="location-x" step="any" required />
                <label for="location-y">Y</label>
                <input type="number" id="location-y" name="location-y" step="any" required />
                <label for="location-z">Z</label>
                <input type="number" id="location-z" name="location-z" step="any" required />
            </form>
        </div>
        <button class="save-changes-btn" id="save-location-btn">Save Changes</button>
        <button class="clear-fields-btn" id="clear-fields-btn">Clear All Fields</button>
    </div>
    <script>
        function goBackToAdminTools(){
            window.location.href = "./admin-tools.html"
        }

    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // Reuse the same Firebase config as other admin pages
        const firebaseConfig = {
            apiKey: "AIzaSyB8Xi8J7t3wRSy1TeIxiGFz-Is6U0zDFVg",
            authDomain: "navigatecampus.firebaseapp.com",
            projectId: "navigatecampus",
            storageBucket: "navigatecampus.appspot.com",
            messagingSenderId: "55012323145",
            appId: "1:55012323145:web:3408681d5a450f05b2b498",
            measurementId: "G-39WFZN3VPV"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const saveBtn = document.getElementById('save-location-btn');
        const clearBtn = document.getElementById('clear-fields-btn');
        const nameInput = document.getElementById('location-name');
        const xInput = document.getElementById('location-x');
        const yInput = document.getElementById('location-y');
        const zInput = document.getElementById('location-z');
        const imageInput = document.getElementById('location-image');

        async function saveCoordinates() {
            const name = nameInput.value.trim();
            const x = parseFloat(xInput.value);
            const y = parseFloat(yInput.value);
            const z = parseFloat(zInput.value);

            if (!name || Number.isNaN(x) || Number.isNaN(y) || Number.isNaN(z)) {
                alert('Please provide a name and valid numeric X, Y, Z values.');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.textContent = 'Saving...';
            try {
                await addDoc(collection(db, 'coordinates'), {
                    name,
                    x,
                    y,
                    z,
                    createdAt: serverTimestamp()
                });
                alert('Location saved to Firestore.');
                // Optionally clear the form
                // nameInput.value = '';
                // descInput.value = '';
                // xInput.value = '';
                // yInput.value = '';
                // zInput.value = '';
            } catch (err) {
                console.error('Error saving coordinates:', err);
                alert('Failed to save. See console for details.');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'Save Changes';
            }
        }

        saveBtn.addEventListener('click', saveCoordinates);

        function clearAllFields() {
            nameInput.value = '';
            xInput.value = '';
            yInput.value = '';
            zInput.value = '';
            if (imageInput) {
                imageInput.value = '';
            }
        }

        clearBtn.addEventListener('click', clearAllFields);
    </script>
</body>
</html>
